<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:p="http://primefaces.org/ui"
      xmlns:f="http://xmlns.jcp.org/jsf/core">

<ui:composition template="../template.xhtml">
    <ui:define name="content-center">
        <h2 style="text-align: center;">Cars</h2>


        <p:poll interval="5" listener="#{uavController.handleCarAlert()}" update="alertsCarForm:alertsCarTable odsCarTransactions:badgeWrapper" />


        <h:form id="alertsCarForm">
            <!-- Pop-up Dialog -->
            <p:dialog id="alertsCarDialog" header="Alerts" widgetVar="alertsCarDialog" responsive="true" showEffect="fade"
                      closable="true">
                <p:outputPanel id="manage-alertsCarDialog-content" class="ui-fluid">
                    <!-- Data Table -->
                    <p:dataTable id="alertsCarTable" value="#{uavController.alertsCar}" var="alert" paginator="true" showGridlines="true"
                                 rows="5" responsiveLayout="scroll" paginatorPosition="bottom" style="width: 1000px">

                        <p:column headerText="ID">
                            <h:outputText value="#{alert.id}" />
                        </p:column>

                        <p:column headerText="License Plate">
                            <h:outputText value="#{alert.licencePlate}" />
                        </p:column>

                        <p:column headerText="Transaction UUID">
                            <h:outputText value="#{alert.transactionUuid}" />
                        </p:column>

                        <p:column headerText="Status" style="width: 200px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">
                            <h:outputText value="#{alert.transactionStatus}" />
                        </p:column>

                        <p:column headerText="Date">
                            <h:outputText value="#{alert.dateTimeCreated}" />
                        </p:column>

                        <p:column headerText="Action">
                            <p:commandButton rendered="#{alert.transactionUuid != null}"
                                             icon="pi pi-eye"
                                             styleClass="p-button-rounded p-button-primary"
                                             actionListener="#{uavController.findCarTransactionsByUuid(alert)}"
                                             oncomplete="PF('alertsCarDialog').hide()">
                            </p:commandButton>
                        </p:column>



                    </p:dataTable>
                </p:outputPanel>
                <f:facet name="footer">
                    <p:commandButton value="Clear Alerts" actionListener="#{uavController.clearCarAlerts()}"
                                     class="ui-button-primary"  />
                    <p:commandButton value="Cancel" icon="pi pi-times" onclick="PF('alertsCarDialog').hide()"
                                     class="ui-button-secondary" type="button" />
                </f:facet>
            </p:dialog>
        </h:form>




        <h:form id ="odsCarTransactions">

            <p:outputPanel id="badgeWrapper">
                <p:badge id="badgeAlert" icon="pi pi-bell" severity="danger" value="#{uavController.alertCountCars}">
                    <p:commandButton id="alertButton" value="Alerts"
                                     icon="pi pi-bell"
                                     update="alertsCarForm"
                                     styleClass="p-button-rounded p-button-outlined p-button-danger"
                                     oncomplete="PF('alertsCarDialog').show()">
                    </p:commandButton>
                </p:badge>
            </p:outputPanel>

            <p:growl id="msgs" showDetail="true"/>
            <p:dataTable id="dataTableOdsCarTransactions" var="carTransactions" value="#{uavController.carTransactionList}"
                         emptyMessage="No car transactions found with given criteria"
                         showGridlines="true"
                         rows="15" paginator="true" paginatorPosition="bottom"
                         paginatorTemplate="{CurrentPageReport} {FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}"
                         currentPageReportTemplate="{startRecord}-{endRecord} of {totalRecords} records"
                         rowsPerPageTemplate="5,10,15,25,50,100,{ShowAll|'All'}">
                <f:facet name="header">
                    <div class="flex justify-content-between align-items-center">
                        List of Cars
                        <p:commandButton value="Reset List"
                                         styleClass="p-button-rounded p-button-secondary flex justify-content-between align-items-center"
                                         actionListener="#{uavController.resetCarsPage()}">
                        </p:commandButton>

                    </div>
                </f:facet>

                <p:column headerText="ID" sortBy="#{carTransactions.id}">
                    <h:outputText value="#{carTransactions.id}" />
                </p:column>

                <p:column headerText="UUID">
                    <h:outputText value="#{carTransactions.transactionUuid}" />
                </p:column>

                <p:column headerText="Status">
                    <h:outputText value="#{carTransactions.transactionStatus}" />
                </p:column>

                <p:column headerText="License Plate" >
                    <h:outputText value="#{carTransactions.licensePlate}" />
                </p:column>

                <p:column headerText="License Plate Confidence" >
                    <h:outputText value="#{carTransactions.licensePlateConfidence}" />
                </p:column>

                <p:column headerText="Person Decision" >
                    <h:outputText value="#{carTransactions.personDecision}" />
                </p:column>

                <p:column headerText="Car Details" >
                    <p:commandButton value="Car Details" rendered="#{carTransactions.transactionUuid != null}"
                                     icon="pi pi-eye"
                                     styleClass="p-button-rounded p-button-secondary"
                                     oncomplete="PF('manageCarDetails').show()"
                                     actionListener="#{uavController.loadCarDetails(carTransactions.transactionUuid)}">
                    </p:commandButton>
                </p:column>


            </p:dataTable>
        </h:form>
        <h:form id="dialogCarDetails">
            <p:dialog header="Car Details" showEffect="fade" widgetVar="manageCarDetails"
                      responsive="true">
                <p:outputPanel id="manage-CarDetails-content" class="ui-fluid">
                    <p:outputPanel rendered="#{not empty uavController.selectedCar}">
                        <div class="ui-grid ui-fluid" style="max-height: 500px; max-width: 730px; overflow-y: auto; padding: 10px;">
                            <div class="ui-grid-row">
                                <div class="ui-grid-col-6" style="padding-right: 15px;">
                                    <p:outputLabel for="licensePlate">License Plate</p:outputLabel>
                                    <p:inputText id="licensePlate" value="#{uavController.selectedCar.licensePlate}" readonly="true"/>
                                </div>
                                <div class="ui-grid-col-6">
                                    <p:outputLabel for="licensePlateConfidence">License Plate Confidence</p:outputLabel>
                                    <p:inputText id="licensePlateConfidence" value="#{uavController.selectedCar.licensePlateConfidence}" readonly="true"/>
                                </div>
                            </div>

                            <div class="ui-grid-row">
                                <div class="ui-grid-col-6" style="padding-right: 15px;">
                                    <p:outputLabel for="carColor">Car Color</p:outputLabel>
                                    <p:inputText id="carColor" value="#{uavController.selectedCar.carColor}" readonly="true"/>
                                </div>
                                <div class="ui-grid-col-6">
                                    <p:outputLabel for="colorConfidence">Color Confidence</p:outputLabel>
                                    <p:inputText id="colorConfidence" value="#{uavController.selectedCar.colorConfidence}" readonly="true"/>
                                </div>
                            </div>

                            <div class="ui-grid-row">
                                <div class="ui-grid-col-6" style="padding-right: 15px;">
                                    <p:outputLabel for="carType">Car Type</p:outputLabel>
                                    <p:inputText id="carType" value="#{uavController.selectedCar.carType}" readonly="true"/>
                                </div>
                                <div class="ui-grid-col-6">
                                    <p:outputLabel for="typeConfidence">Type Confidence</p:outputLabel>
                                    <p:inputText id="typeConfidence" value="#{uavController.selectedCar.typeConfidence}" readonly="true"/>
                                </div>
                            </div>

                            <div class="ui-grid-row">
                                <div class="ui-grid-col-6" style="padding-right: 15px;">
                                    <p:outputLabel for="peopleCounting">People Counting</p:outputLabel>
                                    <p:inputText id="peopleCounting" value="#{uavController.selectedCar.peopleCounting}" readonly="true"/>
                                </div>
                            </div>

                            <div class="ui-grid-row">
                                <div class="ui-grid-col-6" style="padding-right: 15px;">
                                    <p:outputLabel for="datetime">Date Time</p:outputLabel>
                                    <p:inputText id="datetime" value="#{uavController.selectedCar.datetime}" readonly="true"/>
                                </div>
                                <div class="ui-grid-col-6">
                                    <p:outputLabel for="transactionStatus">Transaction Status</p:outputLabel>
                                    <p:inputText id="transactionStatus" value="#{uavController.selectedCar.transactionStatus}" readonly="true"/>
                                </div>
                            </div>

                            <div class="ui-grid-row">
                                <div class="ui-grid-col-6" style="padding-right: 15px;">
                                    <p:outputLabel for="transactionUuid">Transaction UUID</p:outputLabel>
                                    <p:inputText id="transactionUuid" value="#{uavController.selectedCar.transactionUuid}" readonly="true"/>
                                </div>
                                <div class="ui-grid-col-6" style="padding-right: 15px;">
                                    <p:outputLabel for="passengers">Passengers</p:outputLabel>
                                    <p:inputText id="passengers" value="#{uavController.selectedCar.passengers}" readonly="true"/>
                                </div>

                            </div>


                            <p:outputPanel id="passengerOutputPanel" rendered="#{not empty uavController.travelerList}" style="padding-top: 20px">
                                <p:dataTable id="passengerDataTable" value="#{uavController.travelerList}" var="passenger" style="width: 90%;" rows="10">
                                    <p:column headerText="Passenger">
                                        <h:outputText value="#{passenger.firstName} #{passenger.lastName}" style="font-size: 14px;" />
                                    </p:column>
                                    <p:column headerText="Action">
                                        <p:commandButton value="View Details" id="passangerDetails"
                                                         icon="pi pi-eye"
                                                         style="font-size: 14px; padding: 5px; width: 150px; height: 40px;"
                                                         update="dialogPassengersDetails"
                                                         form="dialogCarDetails"
                                                         actionListener="#{uavController.testPF}"
                                                         >


                                        </p:commandButton>
                                    </p:column>
                                </p:dataTable>
                            </p:outputPanel>


                        </div>

                    </p:outputPanel>
                </p:outputPanel>
                <f:facet name="footer">
                    <p:commandButton value="Cancel" icon="pi pi-times" onclick="PF('manageCarDetails').hide()"
                                     class="ui-button-secondary" type="button" />
                </f:facet>
            </p:dialog>
        </h:form>

        <h:form id="dialogPassengersDetails">
            <p:dialog header="Passengers Details"
                      id="managePassengersDetails"
                      widgetVar="managePassengersDetails"
                      showEffect="fade"
                      responsive="true"
                      style="max-width: 750px; width: 80%;"
                      contentStyle="max-height: 480px; max-width: 750px; overflow-y: auto; padding: 10px;">
                <p:outputPanel  id="manage-PassengersDetails-content" class="ui-fluid" style="padding: 10px;">
                    <div class="ui-grid ui-fluid" style="max-height: 460px; max-width: 750px; overflow-y: auto; padding: 10px;">
                        <div class="ui-grid-row">
                            <div class="ui-grid-col-6" style="padding-right: 15px;">
                                <p:outputLabel for="firstname">Firstname</p:outputLabel>
                                <p:inputText id="firstname" value="#{uavController.selectedPassenger.firstName}" readonly="true"/>
                            </div>
                            <div class="ui-grid-col-6">
                                <p:outputLabel for="lastname">Lastname</p:outputLabel>
                                <p:inputText id="lastname" value="#{uavController.selectedPassenger.lastName}" readonly="true"/>
                            </div>
                        </div>
                        <div class="ui-grid-row">
                            <div class="ui-grid-col-6" style="padding-right: 15px;">
                                <p:outputLabel for="dateOfBirth">Date of Birth</p:outputLabel>
                                <p:inputText id="dateOfBirth" value="#{uavController.selectedPassenger.dateOfBirth}" readonly="true"/>
                            </div>
                            <div class="ui-grid-col-6">
                                <p:outputLabel for="placeOfBirth">Place of Birth</p:outputLabel>
                                <p:inputText id="placeOfBirth" value="#{uavController.selectedPassenger.placeOfBirth}" readonly="true"/>
                            </div>
                        </div>

                        <div class="ui-grid-row">
                            <div class="ui-grid-col-6" style="padding-right: 15px;">
                                <p:outputLabel for="street">Street</p:outputLabel>
                                <p:inputText id="street" value="#{uavController.selectedPassenger.street}" readonly="true" />
                            </div>
                            <div class="ui-grid-col-6">
                                <p:outputLabel for="city">City</p:outputLabel>
                                <p:inputText id="city" value="#{uavController.selectedPassenger.city}" readonly="true"/>
                            </div>
                        </div>

                        <div class="ui-grid-row">
                            <div class="ui-grid-col-6" style="padding-right: 15px;">
                                <p:outputLabel for="country">Country</p:outputLabel>
                                <p:inputText id="country" value="#{uavController.selectedPassenger.county}" readonly="true"/>
                            </div>
                            <div class="ui-grid-col-6">
                                <p:outputLabel for="countryCode">Country Code</p:outputLabel>
                                <p:inputText id="countryCode" value="#{uavController.selectedPassenger.countryCode}" readonly="true"/>
                            </div>
                        </div>

                        <div class="ui-grid-row">
                            <div class="ui-grid-col-6" style="padding-right: 15px;">
                                <p:outputLabel for="zipCode">Zip Code</p:outputLabel>
                                <p:inputText id="zipCode" value="#{uavController.selectedPassenger.zipCode}" readonly="true"/>
                            </div>
                            <div class="ui-grid-col-6">
                                <p:outputLabel for="email">Email</p:outputLabel>
                                <p:inputText id="email" value="#{uavController.selectedPassenger.email}" readonly="true"/>
                            </div>
                        </div>

                        <div class="ui-grid-row">
                            <div class="ui-grid-col-6" style="padding-right: 15px;">
                                <p:outputLabel for="documentType">Document Type</p:outputLabel>
                                <p:inputText id="documentType" value="#{uavController.selectedPassenger.documentType}" readonly="true"/>
                            </div>
                            <div class="ui-grid-col-6">
                                <p:outputLabel for="documentNumberTraveler">Document Number</p:outputLabel>
                                <p:inputText id="documentNumberTraveler" value="#{uavController.selectedPassenger.documentNumber}" readonly="true"/>
                            </div>
                        </div>

                        <div class="ui-grid-row">
                            <div class="ui-grid-col-6" style="padding-right: 15px;">
                                <p:outputLabel for="documentIssuer">Document Issuer</p:outputLabel>
                                <p:inputText id="documentIssuer" value="#{uavController.selectedPassenger.documentIssuer}" readonly="true"/>
                            </div>
                            <div class="ui-grid-col-6">
                                <p:outputLabel for="documentValidity">Document Validity</p:outputLabel>
                                <p:inputText id="documentValidity" value="#{uavController.selectedPassenger.documentValidity}" readonly="true"/>
                            </div>
                        </div>
                    </div>

                </p:outputPanel>

                <f:facet name="footer">
                    <p:commandButton value="Cancel"
                                     icon="pi pi-times"
                                     onclick="PF('managePassengersDetails').hide(); #{uavController.clearTravelerList()}"
                                     class="ui-button-secondary"
                                     type="button" />

                </f:facet>
            </p:dialog>
        </h:form>



    </ui:define>
</ui:composition>
</html>